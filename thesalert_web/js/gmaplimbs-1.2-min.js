/*
 * GMap LIMBs: Labels In the Map Border for Google Maps.
 * Version 1.2
 *   by Stephen Battey
 *
 * http://sourceforge.net/p/gmaplimbs
 * http://www.lucidviews.net/software/gmaplimbs
 * 
 * This library is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; version 3 of the License.
 * 
 * This library is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU Lesser General Public License for more details.
 * You should have received a copy of the GNU General Public License along
 * with the files in this library. If not, see  http://www.gnu.org/licenses
 * Distributed under the GNU Library or Lesser General Public License (LGPL)
 */

if(typeof lucid==="undefined"){lucid={}}if(typeof lucid.maps==="undefined"){lucid.maps={}}if(typeof lucid.maps.geometry==="undefined"){lucid.maps.geometry={}}if(typeof lucid.maps.callout==="undefined"){lucid.maps.callout={}}if(typeof lucid.maps.callout.content==="undefined"){lucid.maps.callout.content={}}if(typeof lucid.maps.limbs==="undefined"){lucid.maps.limbs={}}if(typeof lucid.maps.limbs.layout==="undefined"){lucid.maps.limbs.layout={}}if(typeof lucid.maps.limbs.location==="undefined"){lucid.maps.limbs.location={}}if(typeof lucid.maps.limbs.tooltip==="undefined"){lucid.maps.limbs.tooltip={}}if(typeof lucid.maps.places==="undefined"){lucid.maps.places={}}lucid.maps.callout.InfoBox=function(b){var c;var f;function d(){c=new InfoBox(b)}this.add=function(g){g.infoBoxClickEventListener=google.maps.event.addListener(g,"click",a(g))};this.remove=function(g){if(g.infoBoxClickEventListener){google.maps.event.removeListener(g.infoBoxClickEventListener);g.infoBoxClickEventListener=null}if(g==f){this.close()}};this.close=function(){c.close();f=null};function a(g){return function(){c.close();f=g;c.setContent(e(g));c.open(g.getMap(),g)}}function e(g){var j=(b.contentCreator)?b.contentCreator(g):lucid.maps.callout.createContentTitle(g);var i=jQuery("<div class='content'></div>");i.append(j);var h=jQuery("<div class='custom-info-box'><div class='arrow'></div></div>");h.append(i);return h[0]}d()};lucid.maps.callout.InfoBoxOptions={};lucid.maps.callout.content.createContentTitle=function(a){var c=jQuery("<div class='place-name'>"+a.getTitle()+"</div>");var b=jQuery("<div></div>");b.append(c);return b};lucid.maps.callout.content.createContentPlaceInfo=function(b){var d=lucid.maps.callout.content.createContentTitle(b);var f;if(typeof b.placeReference!=="undefined"){f="Loading ...";c()}else{f="No place ref for marker."}var a=jQuery("<div class='place-info'>"+f+"</div>");d.append(a);return d;function c(){var h=new google.maps.places.PlacesService(b.getMap());var g={reference:b.placeReference};h.getDetails(g,e)}function e(h,g){var i=new lucid.maps.places.PlaceDetailParser(h);var j="";if(i.hasRating()){j+="<p>Rating: "+i.getRating()+"</p>"}if(i.hasOpeningHours()){j+="<p>"+i.getOpeningHoursToday()+"</p>"}a.html(j)}};lucid.maps.geometry.computeBounds=function(e){var a=e.getPath();var d=new google.maps.LatLngBounds();var c=a.getArray();for(var b=0;b<c.length;b++){d.extend(c[b])}return d};lucid.maps.geometry.computeNormalisedHeading=function(c,b){var a=google.maps.geometry.spherical.computeHeading(c,b);return lucid.maps.geometry.normaliseHeading(a)};lucid.maps.geometry.computeLatLngBoundsIntersection=function(a,c){var b=a.getNorthEast().lng()-a.getSouthWest().lng();var d=a.getNorthEast().lat()-a.getSouthWest().lat();var e=lucid.maps.geometry.computeBoundingBoxIntersection(b,d,a.getCenter().lng(),a.getCenter().lat(),c);return new google.maps.LatLng(e.y,e.x)};lucid.maps.geometry.computeBoundingBoxIntersection=function(c,b,e,d,f){var a=lucid.maps.geometry.convertHeadingToAngle(f);return lucid.maps.geometry.computeBoundingBoxIntersectionAtAngle(c,b,e,d,a)};lucid.maps.geometry.computeBoundingBoxIntersectionAtAngle=function(e,a,g,f,h){var c=(h>Math.PI)?-(a/2):(a/2);var b=c/Math.sin(h);var d=b*Math.cos(h);if(Math.abs(d)>(e/2)){d=((h>(Math.HALF_PI))&&(h<(Math.THREE_HALVES_PI)))?-(e/2):(e/2);b=d/Math.cos(h);c=b*Math.sin(h)}return{x:g+d,y:f+c}};lucid.maps.geometry.tiltedHeading=function(c,a){var b=lucid.maps.geometry.convertHeadingToAngle(c);return lucid.maps.geometry.tiltedAngle(b,a)};lucid.maps.geometry.tiltedAngle=function(e,b){var d=lucid.maps.geometry.convertToRadians(b);var a=Math.cos(e);var c=Math.sin(e);c=c*Math.cos(d);return Math.vectorAngle(a,c)};lucid.maps.geometry.convertHeadingToAngle=function(a){return lucid.maps.geometry.convertToRadians(90-a)};lucid.maps.geometry.convertToRadians=function(a){return a*Math.PI/180};lucid.maps.geometry.normaliseHeading=function(a){while(a>360){a-=360}while(a<0){a+=360}return a};lucid.maps.geometry.normaliseAngle=function(a){while(a>Math.TWO_PI){a-=Math.TWO_PI}while(a<0){a+=Math.TWO_PI}return a};lucid.maps.limbs.DirectionsController=function(i){var a;var b;var c;function h(){a=i.map;var k={clickHandlerFactory:g};if(typeof i.markerOptions!=="undefined"){lucid.maps.limbs.applyMarkerOptions(k,i.markerOptions)}var l={syncClick:true};if(typeof i.limbOptions!=="undefined"){lucid.maps.limbs.applyLimbOptions(l,i.limbOptions)}var j={map:a,markerOptions:k,limbOptions:l};b=new lucid.maps.limbs.LimbMarkerFactory(j);var m={map:a,hideRouteList:true,routeIndex:0,draggable:false,preserveViewport:false,suppressMarkers:true,suppressInfoWindows:true};c=new google.maps.DirectionsRenderer(m)}this.addTransportLink=function(n){var m=(typeof n.markerOptions==="undefined")?{}:n.markerOptions;var l=(typeof n.limbOptions==="undefined")?{}:n.limbOptions;var k=b.addCustomised(m,l);var j=k.getTarget();j.directionsOptions={origin:j.getPosition(),provideRouteAlternatives:false};if(typeof i.directionOptions!=="undefined"){lucid.maps.limbs.applyDirectionsOptions(j.directionsOptions,i.directionOptions)
}if(typeof n.directionOptions!=="undefined"){lucid.maps.limbs.applyDirectionsOptions(j.directionsOptions,n.directionOptions)}return k};function g(j){return function(){f();d(j.getPosition(),j.directionsOptions.destination);new google.maps.DirectionsService().route(j.directionsOptions,e)}}function f(){c.setMap(null)}function d(k,j){var l=new google.maps.LatLngBounds();l=l.extend(k);l=l.extend(j);a.fitBounds(l)}function e(k,j){if(j==google.maps.DirectionsStatus.OK){c.setDirections(k);c.setMap(a)}}h()};lucid.maps.limbs.TransportLinkOptions={};lucid.maps.limbs.DirectionsControllerOptions={};lucid.maps.limbs.Limb=function(f){var t=this;var g=(f.constructor==(new google.maps.Marker()).constructor)?{target:f}:f;var s;var p;var x;var o;var n;var h;var l;var e;var m;var c;function r(){s=g.hidden;x=g.target;h=(typeof g.syncClick==="boolean")?g.syncClick:false;l=(typeof g.layout==="object")?g.layout:new lucid.maps.limbs.layout.DefaultLayoutStrategy();e=(typeof g.location==="object")?g.location:new lucid.maps.limbs.location.BoundsEdgeLocationStrategy();c=(typeof g.tooltipFactory==="function")?g.tooltipFactory:lucid.maps.limbs.tooltip.standardTooltip;m=e.getMethodForTargetType(x);if(g.independent!==false){n=google.maps.event.addListener(t.getMap(),"bounds_changed",u)}b();t.refresh()}this.destroy=function(){x=null;if(n){google.maps.event.removeListener(n)}q()};function b(){var y=j();o=jQuery("<div></div>");o.css("background","url( '"+y.url+"' ) no-repeat center center");o.css("position","absolute");o.css("width",y.size.width);o.css("height",y.size.height);o.css("zIndex",l.getMinZIndex());o.hide();if(g.clickable!==false){o.css("cursor","pointer");o.click(i)}o.appendTo(v())}function q(){if(o){o.remove();o=null}}this.hide=function(){s=true;if(o){o.hide()}};this.show=function(){s=false;if(o){if(p===true){o.show()}}};this.getMap=function(){return x.getMap()};this.getTarget=function(){return x};function k(){if(typeof g.title!=="undefined"){return g.title}else{if(typeof x.getTitle==="function"){return x.getTitle()}else{if(console){console.log("No title defined for LIMB.")}return"<no title>"}}}function j(){if(typeof g.icon!=="undefined"){return g.icon}else{if(typeof x.getIcon==="function"){return x.getIcon()}else{if(console){console.log("No icon defined for LIMB.")}return{size:new google.maps.Size(20,20),url:"no_icon.png"}}}}function a(){return jQuery(t.getMap().getDiv())}function v(){return a().parent()}function i(){google.maps.event.trigger(t,"click",t);if(h===true){google.maps.event.trigger(x,"click")}}this.setSyncClickWithTarget=function(y){h=y};function u(){t.refresh()}this.refresh=function(){var O=this.getMap();var L=a();var D=O.getBounds();if(typeof D==="undefined"){w();return}var N=m(x,D);if(D.contains(N)){w();return}else{d()}var H=O.getCenter();var C=lucid.maps.geometry.computeNormalisedHeading(H,N);var z=lucid.maps.geometry.convertHeadingToAngle(C);if(O.getTilt()>0){z=lucid.maps.geometry.tiltedAngle(z,O.getTilt())}z=lucid.maps.geometry.normaliseAngle(z);var K=L.width();var I=L.height();var E=lucid.maps.geometry.computeBoundingBoxIntersectionAtAngle(K,I,0,0,z);var y={x:(K/2)+E.x,y:(I/2)-E.y};var J={};J.x=Math.round(y.x-(o.width()/2));J.y=Math.round(y.y-(o.height()/2));var P=L.position();var M=(L.outerWidth(true)-L.innerWidth())/2;var A=(L.outerHeight(true)-L.innerHeight())/2;J.x=P.left+M+J.x;J.y=P.top+A+J.y;var G={viewCentre:H,targetLocation:N,heading:C};l.layout(o,J,G);if(g.clickable!==false){var Q=F();var B=google.maps.geometry.spherical.computeDistanceBetween(Q,N);o.attr("title",c(k(),B,J,G))}function F(){var W=D.getNorthEast().lat()-D.getSouthWest().lat();var T=W/I;var V=H.lat()+(E.y*T);var U=D.getNorthEast().lng()-D.getSouthWest().lng();var S=U/K;var R=H.lng()+(E.x*S);return new google.maps.LatLng(V,R)}};function w(){p=false;o.hide()}function d(){p=true;if(s===true){o.hide()}else{o.show()}}r()};lucid.maps.limbs.LimbOptions={};lucid.maps.limbs.applyLimbOptions=function(a,b){if(typeof b.hidden!=="undefined"){a.hidden=b.hidden}if(typeof b.independent!=="undefined"){a.independent=b.independent}if(typeof b.target!=="undefined"){a.target=b.target}if(typeof b.title!=="undefined"){a.title=b.title}if(typeof b.icon!=="undefined"){a.icon=b.icon}if(typeof b.clickable!=="undefined"){a.clickable=b.clickable}if(typeof b.syncClick!=="undefined"){a.syncClick=b.syncClick}if(typeof b.layout!=="undefined"){a.layout=b.layout}if(typeof b.location!=="undefined"){a.location=b.location}if(typeof b.tooltipFactory!=="undefined"){a.tooltipFactory=b.tooltipFactory}};lucid.maps.limbs.LimbFactory=function(e,a){var g;var d;function f(){g=[];d=false;google.maps.event.addListener(e,"bounds_changed",c)}function c(){b()}function b(){var j=((typeof a!=="undefined")&&(typeof a.layout!=="undefined"))?a.layout:null;if(j){j.init()}for(var h=0;h<g.length;h++){g[h].refresh()}if(j){j.complete()}}this.add=function(h){g[g.length]=h};this.create=function(i){var j={};if(typeof a!=="undefined"){lucid.maps.limbs.applyLimbOptions(j,a)}if(i.constructor==(new google.maps.Marker()).constructor){j.target=i
}else{lucid.maps.limbs.applyLimbOptions(j,i)}j.hidden=d;j.independent=false;var h=new lucid.maps.limbs.Limb(j);this.add(h);return h};this.hide=function(){d=true;for(var h=0;h<g.length;h++){g[h].hide()}};this.show=function(){d=false;for(var h=0;h<g.length;h++){g[h].show()}};this.removeAll=function(){g=[]};this.destroyAll=function(){for(var h=0;h<g.length;h++){g[h].destroy();g[h]=null}g=[]};f()};lucid.maps.limbs.LimbMarkerFactory=function(a){var c;var d;function b(){var e=(typeof a.limbOptions!=="undefined")?a.limbOptions:{};c=[];d=new lucid.maps.limbs.LimbFactory(a.map,e)}this.removeAll=function(){for(var e=0;e<c.length;e++){if(typeof a.infoBox!=="undefined"){a.infoBox.remove(c[e])}c[e].setMap(null);c[e]=null}c=[];d.destroyAll()};this.add=function(e,h){var f={position:e,title:h};var g={};return this.addCustomised(f,g)};this.addCustomised=function(h,g){var f={};lucid.maps.limbs.applyMarkerOptions(f,a.markerOptions);lucid.maps.limbs.applyMarkerOptions(f,h);f.map=a.map;var e=new google.maps.Marker(f);if(typeof a.infoBox!=="undefined"){a.infoBox.add(e)}if(typeof f.clickHandlerFactory==="function"){google.maps.event.addListener(e,"click",f.clickHandlerFactory(e))}c[c.length]=e;g.target=e;return d.create(g)};this.zoomToAll=function(g){var e=[];for(var f=0;f<c.length;f++){e[e.length]=c[f].getPosition()}if(g.additionalLocations){for(var f=0;f<g.additionalLocations.length;f++){e[e.length]=g.additionalLocations[f]}}if(e.length>0){var h=new google.maps.LatLngBounds(e[0],e[0]);for(var f=0;f<e.length;f++){h=h.extend(e[f])}a.map.fitBounds(h)}};this.hide=function(){d.hide()};this.show=function(){d.show()};this.destroy=function(){this.removeAll()};this.getNumberOfMarkers=function(){return c.length};b()};lucid.maps.limbs.LimbMarkerFactoryOptions={};lucid.maps.limbs.applyMarkerOptions=function(a,b){if(typeof b.anchorPoint!=="undefined"){a.anchorPoint=b.anchorPoint}if(typeof b.animation!=="undefined"){a.animation=b.animation}if(typeof b.clickable!=="undefined"){a.clickable=b.clickable}if(typeof b.crossOnDrag!=="undefined"){a.crossOnDrag=b.crossOnDrag}if(typeof b.cursor!=="undefined"){a.cursor=b.cursor}if(typeof b.draggable!=="undefined"){a.draggable=b.draggable}if(typeof b.flat!=="undefined"){a.flat=b.flat}if(typeof b.icon!=="undefined"){a.icon=b.icon}if(typeof b.map!=="undefined"){a.map=b.map}if(typeof b.optimized!=="undefined"){a.optimized=b.optimized}if(typeof b.position!=="undefined"){a.position=b.position}if(typeof b.raiseOnDrag!=="undefined"){a.raiseOnDrag=b.raiseOnDrag}if(typeof b.shadow!=="undefined"){a.shadow=b.shadow}if(typeof b.shape!=="undefined"){a.shape=b.shape}if(typeof b.title!=="undefined"){a.title=b.title}if(typeof b.visible!=="undefined"){a.visible=b.visible}if(typeof b.zIndex!=="undefined"){a.zIndex=b.zIndex}if(typeof b.clickHandlerFactory!=="undefined"){a.clickHandlerFactory=b.clickHandlerFactory}};lucid.maps.limbs.applyDirectionsOptions=function(a,b){if(typeof b.avoidHighways!=="undefined"){a.avoidHighways=b.avoidHighways}if(typeof b.avoidTolls!=="undefined"){a.avoidTolls=b.avoidTolls}if(typeof b.destination!=="undefined"){a.destination=b.destination}if(typeof b.durationInTraffic!=="undefined"){a.durationInTraffic=b.durationInTraffic}if(typeof b.optimizeWaypoints!=="undefined"){a.optimizeWaypoints=b.optimizeWaypoints}if(typeof b.origin!=="undefined"){a.origin=b.origin}if(typeof b.provideRouteAlternatives!=="undefined"){a.provideRouteAlternatives=b.provideRouteAlternatives}if(typeof b.region!=="undefined"){a.region=b.region}if(typeof b.transitOptions!=="undefined"){a.transitOptions=b.transitOptions}if(typeof b.travelMode!=="undefined"){a.travelMode=b.travelMode}if(typeof b.unitSystem!=="undefined"){a.unitSystem=b.unitSystem}if(typeof b.waypoints!=="undefined"){a.waypoints=b.waypoints}};lucid.maps.limbs.LimbMarkerPlacesFactory=function(c){lucid.maps.limbs.LimbMarkerFactory.apply(this,[c]);var b={zoomToAll:this.zoomToAll,add:this.add,addCustomised:this.addCustomised};var g;var a;function h(){g=(typeof c.zoomLevelWhenSelected==="undefined")?16:c.zoomLevelWhenSelected;a=false;google.maps.event.addListener(c.map,"zoom_changed",f)}function f(){a=false}function e(j,i){if(typeof i!=="undefined"){j.getTarget().placeReference=i}}this.add=function(i,l,j){var k=b.add.apply(this,[i,l]);e(k,j);return k};this.addCustomised=function(l,k,i){if(typeof l.clickHandlerFactory==="undefined"){l.clickHandlerFactory=d}var j=b.addCustomised.apply(this,[l,k]);e(j,i);return j};function d(i){return function(){if(a===true){if(g!=null){c.map.setZoom(g)}}if(typeof c.infoBox==="undefined"){c.map.setCenter(i.getPosition())}}}this.zoomToAll=function(i){b.zoomToAll.apply(this,[i]);a=true};h()};lucid.maps.limbs.LimbMarkerPlacesFactoryOptions={};lucid.maps.limbs.layout.DefaultLayoutStrategy=function(){lucid.maps.limbs.layout.LayoutStrategy.apply(this,[{}]);this.layout=function(c,a,b){c.css("left",a.x);c.css("top",a.y);c.css("zIndex",this.getMinZIndex())}};lucid.maps.limbs.layout.LayoutStrategy=function(a){this.init=function(){};this.layout=function(d,b,c){};
this.complete=function(){};this.getMaxZIndex=function(){return(typeof a.maxZ==="number")?a.maxZ:600};this.getMinZIndex=function(){return(typeof a.minZ==="number")?a.minZ:500}};lucid.maps.limbs.layout.LayoutStrategyOptions={};lucid.maps.limbs.layout.OrderedLayoutStrategy=function(a){lucid.maps.limbs.layout.LayoutStrategy.apply(this,[a]);var c;var b;this.layout=function(g,d,e){var f=google.maps.geometry.spherical.computeDistanceBetween(e.viewCentre,e.targetLocation);if(f>b){b=f}c[c.length]={element:g,position:d,distance:f}};this.init=function(){c=[];b=0};this.complete=function(){var k=this.getMinZIndex();var g=this.getMaxZIndex();var d=g-k;var j=d/b;for(var h=0;h<c.length;h++){var f=c[h];f.element.css("left",f.position.x);f.element.css("top",f.position.y);f.element.css("zIndex",e(f.distance))}c=null;b=null;function e(i){return Math.floor(g-(j*i))}}};lucid.maps.limbs.layout.OrderedLayoutStrategyOptions={};lucid.maps.limbs.layout.ZShiftedLayoutStrategy=function(b){lucid.maps.limbs.layout.LayoutStrategy.apply(this,[b]);var c;var a=this.createSuperReferences();this.layout=function(f,d,e){a.layout(f,d,e);c[c.length]={element:f,position:d,mapDetails:e}};this.init=function(){a.init();c=[]};this.complete=function(){var e=this.getMinZIndex();var m=this.getMaxZIndex();var l=m-e;var r;var k;for(var g=0;g<c.length;g++){var h=c[g];if(h!==null){k=[];s(h,g);o(h);if(k.length===1){h.element.css("left",h.position.x);h.element.css("top",h.position.y)}else{n();for(var f=0;f<k.length;f++){var p=k[f];p.element.css("left",p.position.x);p.element.css("top",p.position.y);p.element.css("zIndex",d(p.distance))}}}}c=null;a.complete();function o(t){for(var u=0;u<c.length;u++){var j=c[u];if(j!==null){if(q(t.element,j.element)){s(j,u);o(j)}}}}function q(w,y){var j=w.offset().left;var D=w.offset().top;var A=w.outerHeight(true);var x=w.outerWidth(true);var E=D+A;var u=j+x;var i=y.offset().left;var C=y.offset().top;var z=y.outerHeight(true);var v=y.outerWidth(true);var B=C+z;var t=i+v;if(E<C||D>B||u<i||j>t){return false}return true}function s(i,j){c[j]=null;k[k.length]=i}function n(){var u=0;for(var t=0;t<k.length;t++){var j=k[t];j.distance=google.maps.geometry.spherical.computeDistanceBetween(j.mapDetails.viewCentre,j.mapDetails.targetLocation);if(j.distance>u){u=j.distance}}r=l/u}function d(i){return Math.floor(m-(r*i))}}};lucid.maps.limbs.layout.ZShiftedLayoutStrategyOptions={};lucid.maps.limbs.location.BoundsEdgeLocationStrategy=function(d){lucid.maps.limbs.location.LocationStrategy.apply(this,[d]);this.computeMarkerLocation=function(f,e){return f.getPosition()};this.computePolylineLocation=function(g,e){var f=lucid.maps.geometry.computeBounds(g);return b(f,e)};this.computePolygonLocation=function(g,e){var f=lucid.maps.geometry.computeBounds(g);return b(f,e)};this.computeRectangleLocation=function(f,e){return b(f.getBounds(),e)};this.computeCircleLocation=function(f,e){return b(f.getBounds(),e)};function b(h,f){var e=(h.getSouthWest().lat()>f.getNorthEast().lat());var j=(h.getNorthEast().lat()<f.getSouthWest().lat());var i=(h.getSouthWest().lng()>f.getNorthEast().lng());var g=(h.getNorthEast().lng()<f.getSouthWest().lng());if(e&&i){return h.getSouthWest()}if(e&&g){return new google.maps.LatLng(h.getSouthWest().lat(),h.getNorthEast().lng())}if(j&&i){return new google.maps.LatLng(h.getNorthEast().lat(),h.getSouthWest().lng())}if(j&&g){return h.getNorthEast()}if(e){return new google.maps.LatLng(h.getSouthWest().lat(),a(h,f))}if(j){return new google.maps.LatLng(h.getNorthEast().lat(),a(h,f))}if(i){return new google.maps.LatLng(c(h,f),h.getSouthWest().lng())}if(g){return new google.maps.LatLng(c(h,f),h.getNorthEast().lng())}return f.getCenter()}function a(k,f){var g=f.getSouthWest().lng();var j=f.getNorthEast().lng();var e=k.getSouthWest().lng();var i=k.getNorthEast().lng();var h=(g>e)?g:e;var l=(j<i)?j:i;return(h+l)/2}function c(h,g){var f=g.getSouthWest().lat();var k=g.getNorthEast().lat();var l=h.getSouthWest().lat();var i=h.getNorthEast().lat();var e=(f>l)?f:l;var j=(k<i)?k:i;return(e+j)/2}};lucid.maps.limbs.location.CentreLocationStrategyOptions={};lucid.maps.limbs.location.CentreLocationStrategy=function(a){lucid.maps.limbs.location.LocationStrategy.apply(this,[a]);this.computeMarkerLocation=function(b){return b.getPosition()};this.computePolylineLocation=function(b){return lucid.maps.geometry.computeBounds(b).getCenter()};this.computePolygonLocation=function(b){return lucid.maps.geometry.computeBounds(b).getCenter()};this.computeRectangleLocation=function(b){return b.getBounds().getCenter()};this.computeCircleLocation=function(b){return b.getCenter()}};lucid.maps.limbs.location.CentreLocationStrategyOptions={};lucid.maps.limbs.location.LocationStrategy=function(c){var b=(new google.maps.Marker()).constructor;var e=(new google.maps.Polyline()).constructor;var f=(new google.maps.Polygon()).constructor;var a=(new google.maps.Rectangle()).constructor;var d=(new google.maps.Circle()).constructor;this.getMethodForTargetType=function(g){if(g.constructor==b){return this.computeMarkerLocation
}if(g.constructor==e){return this.computePolylineLocation}if(g.constructor==f){return this.computePolygonLocation}if(g.constructor==a){return this.computeRectangleLocation}if(g.constructor==d){return this.computeCircleLocation}};this.computeLocation=function(i,g){var h=this.getMethodForTargetType(i);return h(i,g)};this.computeMarkerLocation=function(h,g){return null};this.computePolylineLocation=function(h,g){return null};this.computePolygonLocation=function(h,g){return null};this.computeRectangleLocation=function(h,g){return null};this.computeCircleLocation=function(h,g){return null}};lucid.maps.limbs.location.LocationStrategyOptions={};lucid.maps.limbs.tooltip.standardTooltip=function(c,d,b,a){return c+"\n"+lucid.maps.limbs.tooltip.distanceInVariableFormat(d)};lucid.maps.limbs.tooltip.distanceInVariableFormat=function(a){if(a<999.5){return lucid.maps.limbs.tooltip.distanceInWholeUnits(a)+" m"}else{if(a<9950){return lucid.maps.limbs.tooltip.distanceWithOneDecimalPlace(a/1000)+" km"}else{return lucid.maps.limbs.tooltip.distanceInWholeUnits(a/1000)+" km"}}};lucid.maps.limbs.tooltip.distanceInWholeUnits=function(a){return Math.floor(a+0.5)};lucid.maps.limbs.tooltip.distanceWithOneDecimalPlace=function(a){return Math.floor((a*10)+0.5)/10};lucid.maps.places.LabelPlaces=function(m){var j=this;var g;var d;var e;var k;function l(){if(m.button){google.maps.event.addListener(m.button,"click",i)}g=new lucid.maps.limbs.LimbMarkerPlacesFactory(m);d=new google.maps.places.PlacesService(m.map);k=m.types}this.setPlaceTypes=function(n){k=n};function i(){if(m.button.getState()==lucid.maps.places.LabelPlacesState.ACTIVE){j.removePlaces()}else{if(m.button.getState()==lucid.maps.places.LabelPlacesState.PENDING){}else{j.addPlaces()}}}this.addPlaces=function(){if(m.button){m.button.setPending()}e=m.map.getCenter();var n={location:e,rankBy:google.maps.places.RankBy.DISTANCE,types:k};d.nearbySearch(n,a)};function a(q,p,o){if(p==google.maps.places.PlacesServiceStatus.OK){var n=c(q);if(n.length>0){b(n)}else{f()}}else{if(p==google.maps.places.PlacesServiceStatus.ZERO_RESULTS){f()}else{h()}}}function h(){if(m.button){m.button.setError()}}function f(){if(m.button){m.button.setNoResults()}}function b(o){if(m.button){m.button.setActive()}google.maps.event.trigger(j,"pre_add_labels");for(var p=0;p<o.length;p++){var n=o[p];g.add(n.geometry.location,n.name,n.reference)}g.zoomToAll({additionalLocations:[e]});google.maps.event.trigger(j,"post_add_labels")}function c(p){var n=[];for(var o=0;o<p.length;o++){if(typeof m.maxPlaces==="number"){if(o>=m.maxPlaces){break}}if(typeof m.maxDistance==="number"){var q=google.maps.geometry.spherical.computeDistanceBetween(e,p[o].geometry.location);if(q>m.maxDistance){break}}n[n.length]=p[o]}return n}this.removePlaces=function(){if(g.getNumberOfMarkers()>0){google.maps.event.trigger(j,"pre_remove_labels");if(m.button){m.button.setIdle()}g.removeAll();google.maps.event.trigger(j,"post_remove_labels")}};this.hide=function(){g.hide()};this.show=function(){g.show()};this.getNumberOfPlaces=function(){return g.getNumberOfMarkers()};l()};lucid.maps.places.LabelPlacesOptions={};lucid.maps.places.LabelPlacesButton=function(m){var j=this;var b;var g;var e=5000;var c;var i;function l(){c=jQuery(m.buttonDiv);c.click(f);i=jQuery(".graphics",c);j.setIdle()}function f(){google.maps.event.trigger(j,"click")}this.show=function(){c.show()};this.hide=function(){c.hide()};this.setIdle=function(){h(lucid.maps.places.LabelPlacesState.IDLE)};this.setPending=function(){h(lucid.maps.places.LabelPlacesState.PENDING)};this.setActive=function(){h(lucid.maps.places.LabelPlacesState.ACTIVE)};this.setError=function(){h(lucid.maps.places.LabelPlacesState.ERROR);k()};this.setNoResults=function(){h(lucid.maps.places.LabelPlacesState.NO_RESULTS);k()};function h(n){d();if(b){i.removeClass(b)}b=n;i.addClass(b)}this.getState=function(){return b};function k(){d();g=window.setTimeout(a,e)}function d(){if(g){window.clearTimeout(g);g=null}}function a(){j.setIdle()}l()};lucid.maps.places.LabelPlacesState={IDLE:"idle",PENDING:"pending",ACTIVE:"active",ERROR:"error",NO_RESULTS:"no-results"};lucid.maps.places.LabelPlacesButtonOptions={};lucid.maps.places.PlaceDetailParser=function(a){this.hasRating=function(){return(typeof a.rating==="number")};this.getRating=function(){return a.rating};this.hasOpeningHours=function(){return(typeof a.opening_hours!=="undefined")&&(typeof a.opening_hours.periods!=="undefined")&&(typeof a.opening_hours.periods.length==="number")};this.getOpeningHoursToday=function(){return this.getOpeningHours(new Date().getDay())};this.getOpeningHours=function(b){var e=[];for(var c=0;c<a.opening_hours.periods.length;c++){if(a.opening_hours.periods[c].open.day==b){e[e.length]=a.opening_hours.periods[c]}}var d;if(e.length>0){d="Open ";for(var c=0;c<e.length;c++){if(c>0){d+=", "}d+=e[c].open.time+" - "+e[c].close.time}}else{d="Closed"}return d}};Math.vectorAngle=function(c,a){if(Math.abs(c)>1e-8){var b=Math.atan(a/c);if(c<0){b+=Math.PI}return b
}else{if(a<0){return 3*(Math.PI/2)}else{return Math.PI/2}}};Math.HALF_PI=Math.PI/2;Math.THREE_HALVES_PI=3*Math.HALF_PI;Math.TWO_PI=2*Math.PI;